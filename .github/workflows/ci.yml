name: CI-Build-Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # 定义一个名为 "rust-test" 的检查
  rust-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check Rust
        run: echo "Rust check placeholder"

  # 定义一个名为 "python-test" 的检查
  python-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check Python
        run: echo "Python check placeholder"

  # Java 模块检查
  java-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17
      - name: Maven build (skip tests)
        working-directory: services/engine-java
        run: mvn -B -DskipTests package

  # Go 模块检查
  go-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.22"
      - name: Set GOPROXY
        run: go env -w GOPROXY="https://proxy.golang.org,direct"
      - name: Go mod tidy
        working-directory: services/gateway-go
        run: go mod tidy
      - name: Go test
        working-directory: services/gateway-go
        run: go test ./...